<html>
    <head>
        <title> IPHT Calculator</title>
    </head>
    <body>
        <img width="224" height="162" src="https://www.leibniz-ipht.de//wp-content/themes/leibniz_web/img/Logo.svg" alt="Logo" decoding="async" loading="lazy" style="background-color: black; max-width: 100%; border: 10px solid #000; height: auto;">
        <p>Dept. Microscopy, Nyquist calculator</p>
        <table>
        <tbody>
            <tr>
                <td>NA:</td><td><input id="NA" type="text" value="1.4" onchange="NA_changed()"></td>
            </tr>
            <tr>
                <td>n:</td><td><input id="n" type="text" value="1.518" onchange="n_changed()"></td>
            </tr>
            <tr>
                <td>&lambda;<sub>ex</sub>:</td><td><input id="lambda_ex" type="text" value="0.488" onchange="lambda_ex_changed()"></td><td>&mu;m</td>
            </tr>
            <tr>
                <td>&lambda;<sub>em</sub>:</td><td><input id="lambda_em" type="text" value="0.488" onchange="lambda_em_changed()"></td><td>&mu;m</td>
            </tr>
            <tr>
                <td style="padding-top: 10px">WF XY samp.:</td><td style="padding-top: 10px"><input id="sampling_WF_XY" type="text" value="?" onchange="sampling_WF_XY_changed()"></td><td>&mu;m</td>
            </tr>
            <tr>
                <td>WF Z samp.:</td><td><input id="sampling_WF_Z" type="text" value="?" onchange="sampling_WF_Z_changed()"></td><td>&mu;m</td>
            </tr>
            <tr>
                <td style="padding-top: 10px">Conf. XY samp.:</td><td style="padding-top: 10px"><input id="sampling_Conf_XY" type="text" value="?" onchange="sampling_C_XY_changed()"></td><td>&mu;m</td>
            </tr>
            <tr>
                <td>Conf. Z samp.:</td><td><input id="sampling_Conf_Z" type="text" value="?" onchange="sampling_C_Z_changed()"></td><td>&mu;m</td>
            </tr>

            <tr>
                <td style="padding-top: 10px">Magn.:</td><td style="padding-top: 10px"><input id="mag" type="text" value="?" onchange="mag_changed()"></td><td>&#10005;</td>
            </tr>
            <tr>
                <td>Postmag:</td><td><input id="postmag" type="text" value="1.0" onchange="postmag_changed()"></td><td>&#10005;</td>
            </tr>
            <tr>
                <td>Cam XY samp.:</td><td><input id="sampling_cam_XY" type="text" value="?" onchange="sampling_Cam_XY_changed()"></td><td>&mu;m</td>
            </tr>
        </tbody>
        </table>
        <script>
            set_float(NA, 1.4);
            set_float(n, 1.518);
            set_float(lambda_ex, 0.488);
            set_float(lambda_em, 0.520);
            set_float(mag, 60);
            set_float(postmag, 1.0);
            update_sampling();

            function set_float(atag, val) {
                atag.fval = val
                atag.value = val.toFixed(3)
            }
            function all_white() {
                NA.style.backgroundColor = "white"
                n.style.backgroundColor = "white"
                lambda_ex.style.backgroundColor = "white"
                lambda_em.style.backgroundColor = "white"
                mag.style.backgroundColor = "white"
                postmag.style.backgroundColor = "white"
                sampling_WF_XY.style.backgroundColor = "white"
                sampling_WF_Z.style.backgroundColor = "white"
                sampling_Conf_XY.style.backgroundColor = "white"
                sampling_Conf_Z.style.backgroundColor = "white"
            }
            function get_float(atag, minval=-Infinity, maxval=Infinity) {
                all_white();
                val = parseFloat(atag.value)
                console.log(val)
                if (isNaN(val)) {
                    console.log("bad float")
                    set_float(atag,atag.fval);
                    val = atag.fval
                    atag.style.backgroundColor = "red"
                }
                else
                {
                    console.log(maxval)
                    if (val > maxval) {
                        set_float(atag, maxval);
                        val = maxval
                        atag.fval = val
                        atag.style.backgroundColor = "red"
                    }
                    else if (val < minval) {
                        set_float(atag, minval);
                        val = maxval
                        atag.fval = val
                        atag.style.backgroundColor = "red"
                    }
                    else {
                        console.log("good float")
                        atag.fval = val
                        atag.style.backgroundColor = "lightgreen"
                    }
                }
                return val
            }
            function update_sampling() {
                XY_samp = lambda_em.fval / (4*NA.fval)
                set_float(sampling_WF_XY, XY_samp)
                alpha = Math.asin(NA.fval/n.fval)
                z_fac = 2*(NA.fval/n.fval)/(1-Math.cos(alpha))
                set_float(sampling_WF_Z, z_fac * XY_samp)
                set_float(sampling_cam_XY, mag.fval * postmag.fval * XY_samp)
                sampling_WF_XY.style.backgroundColor = "lightgreen"
                sampling_WF_Z.style.backgroundColor = "lightgreen"

                lambda_eff = 1/(1/lambda_ex.fval + 1/lambda_em.fval)
                XY_conf = lambda_eff / (4*NA.fval)
                set_float(sampling_Conf_XY, XY_conf)
                set_float(sampling_Conf_Z, z_fac * XY_conf)
                sampling_Conf_XY.style.backgroundColor = "lightgreen"
                sampling_Conf_Z.style.backgroundColor = "lightgreen"
            }

            NA.NA_changed = function()
            {
                console.log("NA_changed")
                res =  get_float(NA, 0.0, n.fval)
                update_sampling();
            }
            n.n_changed = function()
            {
                console.log("n_changed")
                res =  get_float(n, NA.fval, 10);
                update_sampling();
            }
            lambda_ex.lambda_ex_changed = function()
            {
                res =  get_float(lambda_ex, 0.0, 20.0);
                update_sampling();
            }
            lambda_em.lambda_em_changed = function()
            {
                res =  get_float(lambda_em, 0.0, 20.0);
                update_sampling();
            }
            mag.mag_changed = function()
            {
                res =  get_float(mag, 0.0, 150);
                update_sampling();
            }            
            postmag.postmag_changed = function()
            {
                res =  get_float(postmag, 0.1, 3.0);
                update_sampling();
            }            

            sampling_WF_XY.sampling_WF_XY_changed = function()
            {
                console.log("NA_changed")
            }
            sampling_WF_Z.sampling_WF_Z_changed = function()
            {
            }            
            sampling_WF_XY.sampling_C_XY_changed = function()
            {
            }
            sampling_WF_Z.sampling_C_Z_changed = function()
            {
            }            
            sampling_WF_Z.sampling_Cam_XY_changed = function()
            {
            }            
    </script>
    </body>
</html>