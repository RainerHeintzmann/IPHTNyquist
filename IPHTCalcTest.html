<html>
<head>
        <title> IPHT Calculator</title>
    </head>
    <body>
        <style>
        input {
            font-size: 3vw;
            text-align: right;
        }
        table {
            font-size: 3vw;
        }
        select {
            font-size: 3vw;
        }
        </style>
        <img width="224" height="162" src="https://www.leibniz-ipht.de//wp-content/themes/leibniz_web/img/Logo.svg" alt="Logo" decoding="async" loading="lazy" style="background-color: black; min-width: 95%; border: 10px solid #000; height: auto;">
        <p style="font-size: 3vw;">Nyquist samling calculator, Department of Microscopy</p>
        <div>
        <table>
        <tbody>
            <tr>
                <th  style="width:40%"> Property</th> <th  style="width:20%"> Select</th><th  style="width:20%"> Input/Output</th><th  style="width:10%"> Unit</th>
            </tr>
            <tr>
                <td>NA:</td><td>
                    <select name="NA:" id="na_sel" onchange="na_sel_changed()">
                        <option value="1.65">1.65</option>
                        <option value="1.46">1.46</option>
                        <option value="1.4">1.4</option>
                        <option value="1.3">1.3</option>
                        <option value="1.2">1.2</option>
                        <option value="1.0">1.0</option>
                        <option value="0.95">0.95</option>
                        <option value="0.9">0.9</option>
                        <option value="0.75">0.75</option>
                        <option value="0.7">0.7</option>
                        <option value="0.4">0.4</option>
                        <option value="0.2">0.2</option>
                        <option value="0.1">0.1</option>
                      </select></td><td>
                    <input size="6" id="NA" type="text" value="1.4" onchange="NA_changed()"></td>
            </tr>
            <tr>
                <td>n:</td><td>
                    <select name="Material:" id="mat" onchange="mat_changed()">
                        <option value="1.78">HR oil</option>
                        <option value="1.518">oil</option>
                        <option value="1.40">sil. oil</option>
                        <option value="1.46">glycerol</option>
                        <option value="1.33">water</option>
                        <option value="1.0">air</option>
                      </select></td><td>
                    <input size="6" id="n" type="text" value="1.518" onchange="n_changed()"></td>
            </tr>
            <tr>
                <td>&lambda;<sub>ex</sub>:</td><td></td><td><input size="6" id="lambda_ex" type="text" value="0.488" onchange="lambda_ex_changed()"></td><td>&mu;m</td>
            </tr>
            <tr> 
                <td>&lambda;<sub>em</sub>:</td><td></td><td><input size="6" id="lambda_em" type="text" value="0.488" onchange="lambda_em_changed()"></td><td>&mu;m</td>
            </tr>
            <tr>
                <td style="padding-top: 10px">W.F. XY Sampl.:</td><td></td><td style="padding-top: 10px"><input size="6" id="sampling_WF_XY" type="text" readonly="readonly" value="?" onchange="sampling_WF_XY_changed()"></td><td>&mu;m</td>
            </tr>
            <tr> 
                <td>W.F. Z Sampl.:</td><td></td><td><input size="6" id="sampling_WF_Z" type="text" value="?" readonly="readonly" onchange="sampling_WF_Z_changed()"></td><td>&mu;m</td>
            </tr>
            <tr> 
                <td style="padding-top: 10px">Conf. XY samp.:</td><td></td><td style="padding-top: 10px"><input size="6" id="sampling_Conf_XY" readonly="readonly" type="text" value="?" onchange="sampling_C_XY_changed()"></td><td>&mu;m</td>
            </tr>
            <tr> 
                <td>Conf. Z Sampl.:</td><td></td><td><input size="6" id="sampling_Conf_Z" type="text" value="?" readonly="readonly" onchange="sampling_C_Z_changed()"></td><td>&mu;m</td>
            </tr>

            <tr>
                <td style="padding-top: 10px">Magnification:</td><td style="padding-top: 10px">
                    <select name="Mag:" id="mag_sel" onchange="mag_sel_changed()">
                        <option style="background:gray; color:black" value="150">150</option>
                        <option style="background:white; color:black"value="100">100</option>
                        <option style="background:blue; color:white" value="63">63</option>
                        <option style="background:blue; color:white" value="60">60</option>
                        <option style="background:lightblue; color:black" value="40">40</option>
                        <option style="background:gray; color:black" value="25">25</option>
                        <option style="background:green; color:black" value="20">20</option>
                        <option style="background:yellow; color:black"  value="10">10</option>
                      </select></td><td>
                    <input size="6" id="mag" type="text" value="?" onchange="mag_changed()"></td><td>&#10005;</td>
            </tr>
            <tr>
                <td>Post-Magnif.:</td><td>
                    <select name="Mag:" id="postmag_sel" onchange="postmag_sel_changed()">
                        <option value="1.0">1.0</option>
                        <option value="1.5">1.5</option>
                        <option value="2.0">2.0</option>
                        <option value="2.5">2.5</option>
                      </select></td><td>
                    <input size="6" id="postmag" type="text" value="?" onchange="postmag_changed()"></td><td>&#10005;</td>
            </tr>
            <tr>
                <td>Cam. XY Sampl.:</td><td></td><td><input size="6" id="sampling_cam_XY" type="text" value="?"  readonly="readonly" onchange="sampling_Cam_XY_changed()"></td><td>&mu;m</td>
            </tr>
        </tbody>
        </table>
        </div>
        <script>
            function set_float(atag, val) {
                atag.fval = val
                atag.value = val.toFixed(3)
            }
            function all_white() {
                NA.style.backgroundColor = "white"
                n.style.backgroundColor = "white"
                lambda_ex.style.backgroundColor = "white"
                lambda_em.style.backgroundColor = "white"
                mag.style.backgroundColor = "white"
                postmag.style.backgroundColor = "white"
                sampling_WF_XY.style.backgroundColor = "white"
                sampling_WF_Z.style.backgroundColor = "white"
                sampling_Conf_XY.style.backgroundColor = "white"
                sampling_Conf_Z.style.backgroundColor = "white"
            }
            function get_float(atag, minval=-Infinity, maxval=Infinity) {
                all_white();
                val = parseFloat(atag.value)
                console.log(val)
                if (isNaN(val)) {
                    console.log("bad float")
                    set_float(atag,atag.fval);
                    val = atag.fval
                    atag.style.backgroundColor = "red"
                }
                else
                {
                    console.log(maxval)
                    if (val > maxval) {
                        set_float(atag, maxval);
                        val = maxval
                        atag.fval = val
                        atag.style.backgroundColor = "red"
                    }
                    else if (val < minval) {
                        set_float(atag, minval);
                        val = maxval
                        atag.fval = val
                        atag.style.backgroundColor = "red"
                    }
                    else {
                        console.log("good float")
                        atag.fval = val
                        atag.style.backgroundColor = "lightgreen"
                    }
                }
                return val
            }
            function update_sampling() {
                XY_samp = lambda_em.fval / (4*NA.fval)
                set_float(sampling_WF_XY, XY_samp)
                alpha = Math.asin(NA.fval/n.fval)
                z_fac = 2*(NA.fval/n.fval)/(1-Math.cos(alpha))
                set_float(sampling_WF_Z, z_fac * XY_samp)
                set_float(sampling_cam_XY, mag.fval * postmag.fval * XY_samp)
                sampling_WF_XY.style.backgroundColor = "lightgreen"
                sampling_WF_Z.style.backgroundColor = "lightgreen"

                lambda_eff = 1/(1/lambda_ex.fval + 1/lambda_em.fval)
                XY_conf = lambda_eff / (4*NA.fval)
                set_float(sampling_Conf_XY, XY_conf)
                set_float(sampling_Conf_Z, z_fac * XY_conf)
                sampling_Conf_XY.style.backgroundColor = "lightgreen"
                sampling_Conf_Z.style.backgroundColor = "lightgreen"
            }

            mat.mat_changed = function()
            {
                console.log("mat_changed")
                res =  set_float(n, parseFloat(mat.value))
                get_float(NA,0.0, n.fval)                
                update_sampling();
            }

            na_sel_changed = function()
            {
                console.log("mag_sel_changed")
                NA.value = na_sel.value
                res =  get_float(NA, 0.0, n.fval)
                update_sampling();
            }

            mag_sel_changed = function()
            {
                console.log("mag_sel_changed")
                mag_sel.style.backgroundColor = mag_sel.options[mag_sel.selectedIndex].style.backgroundColor
                mag_sel.style.color = mag_sel.options[mag_sel.selectedIndex].style.color
                mag.value = mag_sel.value
                res = get_float(mag)
                update_sampling();
            }

            postmag_sel_changed = function()
            {
                console.log("postmag_sel_changed")
                postmag.value = postmag_sel.value
                res = get_float(postmag)
                update_sampling();
            }

            NA.NA_changed = function()
            {
                console.log("NA_changed")
                res =  get_float(NA, 0.0, n.fval)
                update_sampling();
            }
            n.n_changed = function()
            {
                console.log("n_changed")
                res =  get_float(n, NA.fval, 10);
                update_sampling();
            }
            lambda_ex.lambda_ex_changed = function()
            {
                res =  get_float(lambda_ex, 0.0, 20.0);
                update_sampling();
            }
            lambda_em.lambda_em_changed = function()
            {
                res =  get_float(lambda_em, 0.0, 20.0);
                update_sampling();
            }
            mag.mag_changed = function()
            {
                res =  get_float(mag, 0.0, 150);
                update_sampling();
            }            
            postmag.postmag_changed = function()
            {
                res =  get_float(postmag, 0.1, 3.0);
                update_sampling();
            }            

            sampling_WF_XY.sampling_WF_XY_changed = function()
            {
                console.log("NA_changed")
            }
            sampling_WF_Z.sampling_WF_Z_changed = function()
            {
            }            
            sampling_WF_XY.sampling_C_XY_changed = function()
            {
            }
            sampling_WF_Z.sampling_C_Z_changed = function()
            {
            }            
            sampling_WF_Z.sampling_Cam_XY_changed = function()
            {
            }            
            na_sel.value = "1.4"
            set_float(NA, 1.4);
            mat.value = "1.518"
            set_float(n, 1.518);
            set_float(lambda_ex, 0.488);
            set_float(lambda_em, 0.520);
            mag_sel.value = "60"
            mag_sel_changed()
            set_float(mag, 60);
            postmag_sel.value = "1.0"
            set_float(postmag, 1.0);
            update_sampling();
    </script>
    </body>
</html>